webpackJsonp([1],{"7zck":function(t,e){},FtBh:function(t,e){},I5PC:function(t,e){},NHnr:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("7+uW"),r=n("Zrlr"),i=n.n(r),o=n("wxAW"),s=n.n(o),c=n("vwbq"),u=function(){function t(){i()(this,t)}return s()(t,null,[{key:"appendFront0",value:function(t){return 2!==t.length?"0"+t:t}},{key:"randomColor",value:function(){for(var t=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],e="#",n=0;n<6;n++)e+=t[Math.floor(16*Math.random())];return e}},{key:"getColorStrFromCanvas",value:function(e,n,a){var r=e.getImageData(n,a,1,1).data;return"#"+t.appendFront0(r[0].toString(16))+t.appendFront0(r[1].toString(16))+t.appendFront0(r[2].toString(16))}},{key:"text",value:function(t,e,n,a,r,i){t.font="14px Arial",t.fillStyle=i,t.fillText(e,n,a)}},{key:"wrapText",value:function(t,e,n,a,r,i,o){t.fillStyle=o;for(var s=e.split(" "),c="",u=0;u<s.length;u++){var l=c+s[u]+" ";t.measureText(l).width>r&&u>0?(t.fillText(c,n,a),c=s[u]+" ",a+=i):c=l}t.fillText(c,n,a)}},{key:"roundRect",value:function(t,e,n,a,r,i,o,s){if(void 0===s&&(s=!0),void 0===i&&(i=5),"number"==typeof i)i={tl:i,tr:i,br:i,bl:i};else{var c={tl:0,tr:0,br:0,bl:0};for(var u in c)i[u]=i[u]||c[u]}t.beginPath(),t.moveTo(e+i.tl,n),t.lineTo(e+a-i.tr,n),t.quadraticCurveTo(e+a,n,e+a,n+i.tr),t.lineTo(e+a,n+r-i.br),t.quadraticCurveTo(e+a,n+r,e+a-i.br,n+r),t.lineTo(e+i.bl,n+r),t.quadraticCurveTo(e,n+r,e,n+r-i.bl),t.lineTo(e,n+i.tl),t.quadraticCurveTo(e,n,e+i.tl,n),t.closePath(),o&&t.fill(),s&&t.stroke()}}]),t}(),l=function(){function t(){i()(this,t),this.d3=c,this.init()}return s()(t,[{key:"init",value:function(){this.initVariables(),this.initCanvas(),this.initVirtualNode(),this.setCanvasListener()}},{key:"initVariables",value:function(){this.width=window.innerWidth,this.height=window.innerHeight,this.padding=20,this.nodeWidth=180,this.nodeHeight=280,this.unitPadding=20,this.unitWidth=140,this.unitHeight=100,this.duration=600,this.scale=1}},{key:"draw",value:function(t){this.data=this.d3.hierarchy(t),this.treeGenerator=this.d3.tree().nodeSize([this.nodeWidth,this.nodeHeight]),this.update();var e=this;this.d3.timer(function(){e.drawCanvas()})}},{key:"update",value:function(t){this.treeData=this.treeGenerator(this.data);var e=this.treeData.descendants(),n=this.treeData.links(),a=0,r=0,i=0,o=0;t&&(a=t.x0,r=t.y0,i=t.x,o=t.y),this.updateOrgUnits(e,a,r,i,o),this.updateLinks(n,a,r,i,o),this.addColorKey(),this.bindNodeToTreeData()}},{key:"updateOrgUnits",value:function(t,e,n,a,r){var i=this.virtualContainerNode.selectAll(".orgUnit").data(t,function(t){return t.colorKey});i.attr("class","orgUnit").attr("x",function(t){return t.x0}).attr("y",function(t){return t.y0}).transition().duration(this.duration).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("fillStyle","#ff0000"),i.enter().append("orgUnit").attr("class","orgUnit").attr("x",e).attr("y",n).transition().duration(this.duration).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("fillStyle","#ff0000"),i.exit().transition().duration(this.duration).attr("x",a).attr("y",r).remove(),t.forEach(function(t){t.x0=t.x,t.y0=t.y}),i=null}},{key:"updateLinks",value:function(t,e,n,a,r){var i=this.virtualContainerNode.selectAll(".link").data(t,function(t){return t.source.colorKey+":"+t.target.colorKey});i.attr("class","link").attr("sourceX",function(t){return t.source.x00}).attr("sourceY",function(t){return t.source.y00}).attr("targetX",function(t){return t.target.x00}).attr("targetY",function(t){return t.target.y00}).transition().duration(this.duration).attr("sourceX",function(t){return t.source.x}).attr("sourceY",function(t){return t.source.y}).attr("targetX",function(t){return t.target.x}).attr("targetY",function(t){return t.target.y}),i.enter().append("link").attr("class","link").attr("sourceX",e).attr("sourceY",n).attr("targetX",e).attr("targetY",n).transition().duration(this.duration).attr("sourceX",function(t){return t.source.x}).attr("sourceY",function(t){return t.source.y}).attr("targetX",function(t){return t.target.x}).attr("targetY",function(t){return t.target.y}),i.exit().transition().duration(this.duration).attr("sourceX",a).attr("sourceY",r).attr("targetX",a).attr("targetY",r).remove(),t.forEach(function(t){t.source.x00=t.source.x,t.source.y00=t.source.y,t.target.x00=t.target.x,t.target.y00=t.target.y}),i=null}},{key:"initCanvas",value:function(){this.container=this.d3.select("#org-chart-container"),this.canvasNode=this.container.append("canvas").attr("class","orgChart").attr("width",this.width).attr("height",this.height),this.hiddenCanvasNode=this.container.append("canvas").attr("class","orgChart").attr("width",this.width).attr("height",this.height).style("display",""),this.context=this.canvasNode.node().getContext("2d"),this.context.translate(this.width/2,this.padding),this.hiddenContext=this.hiddenCanvasNode.node().getContext("2d"),this.hiddenContext.translate(this.width/2,this.padding)}},{key:"initVirtualNode",value:function(){var t=document.createElement("root");this.virtualContainerNode=this.d3.select(t),this.colorNodeMap={}}},{key:"addColorKey",value:function(){var t=this;this.virtualContainerNode.selectAll(".orgUnit").each(function(){for(var e=t.d3.select(this),n=u.randomColor();t.colorNodeMap[n];)n=u.randomColor();e.attr("colorKey",n),e.data()[0].colorKey=n,t.colorNodeMap[n]=e})}},{key:"bindNodeToTreeData",value:function(){var t=this;this.virtualContainerNode.selectAll(".orgUnit").each(function(){var e=t.d3.select(this);e.data()[0].node=e})}},{key:"drawCanvas",value:function(){this.drawShowCanvas(),this.drawHiddenCanvas()}},{key:"drawShowCanvas",value:function(){this.context.clearRect(-5e4,-1e4,1e5,1e5);var t=this;this.virtualContainerNode.selectAll(".link").each(function(){var e=t.d3.select(this),n=t.d3.linkVertical().x(function(t){return t.x}).y(function(t){return t.y}).source(function(){return{x:e.attr("sourceX"),y:e.attr("sourceY")}}).target(function(){return{x:e.attr("targetX"),y:e.attr("targetY")}}),a=new Path2D(n());t.context.stroke(a)}),this.virtualContainerNode.selectAll(".orgUnit").each(function(){var e=t.d3.select(this),n=e.data()[0].data;t.context.fillStyle="#3ca0ff";var a=Number(e.attr("x"))-t.unitWidth/2,r=Number(e.attr("y"))-t.unitHeight/2;u.roundRect(t.context,a,r,t.unitWidth,t.unitHeight,4,!0,!1),u.text(t.context,n.name,a+t.unitPadding,r+t.unitPadding,"20px","#ffffff");var i=t.unitWidth-2*t.unitPadding;u.wrapText(t.context,n.title,a+t.unitPadding,r+t.unitPadding+24,i,20)})}},{key:"drawHiddenCanvas",value:function(){this.hiddenContext.clearRect(-5e4,-1e4,1e5,1e5);var t=this;this.virtualContainerNode.selectAll(".orgUnit").each(function(){var e=t.d3.select(this);t.hiddenContext.fillStyle=e.attr("colorKey"),u.roundRect(t.hiddenContext,Number(e.attr("x"))-t.unitWidth/2,Number(e.attr("y"))-t.unitHeight/2,t.unitWidth,t.unitHeight,4,!0,!1)})}},{key:"setCanvasListener",value:function(){this.setClickListener(),this.setDragListener(),this.setMouseWheelZoomListener()}},{key:"setClickListener",value:function(){var t=this;this.canvasNode.node().addEventListener("click",function(e){var n=u.getColorStrFromCanvas(t.hiddenContext,e.layerX,e.layerY),a=t.colorNodeMap[n];a&&(t.toggleTreeNode(a.data()[0]),t.update(a.data()[0]))})}},{key:"setMouseWheelZoomListener",value:function(){var t=this;this.canvasNode.node().addEventListener("mousewheel",function(e){e.preventDefault(),e.deltaY<0?t.bigger():t.smaller()})}},{key:"setDragListener",value:function(){this.onDrag_=!1,this.dragStartPoint_={x:0,y:0};var t=this;this.canvasNode.node().onmousedown=function(e){t.dragStartPoint_.x=e.x,t.dragStartPoint_.y=e.y,t.onDrag_=!0},this.canvasNode.node().onmousemove=function(e){t.onDrag_&&(t.context.translate((e.x-t.dragStartPoint_.x)/t.scale,(e.y-t.dragStartPoint_.y)/t.scale),t.hiddenContext.translate((e.x-t.dragStartPoint_.x)/t.scale,(e.y-t.dragStartPoint_.y)/t.scale),t.dragStartPoint_.x=e.x,t.dragStartPoint_.y=e.y)},this.canvasNode.node().onmouseout=function(e){t.onDrag_&&(t.onDrag_=!1)},this.canvasNode.node().onmouseup=function(e){t.onDrag_&&(t.onDrag_=!1)}}},{key:"toggleTreeNode",value:function(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null)}},{key:"bigger",value:function(){this.scale>7||(this.context.clearRect(-1e6,-1e4,2e6,2e6),this.hiddenContext.clearRect(-1e6,-1e4,2e6,2e6),this.scale=5*this.scale/4,this.context.scale(5/4,5/4),this.hiddenContext.scale(5/4,5/4))}},{key:"smaller",value:function(){this.scale<.2||(this.context.clearRect(-1e6,-1e4,2e6,2e6),this.hiddenContext.clearRect(-1e6,-1e4,2e6,2e6),this.scale=4*this.scale/5,this.context.scale(.8,.8),this.hiddenContext.scale(.8,.8))}}]),t}(),d=function(){function t(){i()(this,t)}return s()(t,null,[{key:"generateOrgChartData",value:function(t){for(var e={name:"Lao Lao",title:"general manager",children:[{name:"Bo Miao",title:"department manager"},{name:"Su Miao",title:"department manager",children:[{name:"Tie Hua",title:"senior engineer"},{name:"Hei Hei",title:"senior engineer",children:[{name:"Pang Pang",title:"engineer"},{name:"Xiang Xiang",title:"UE engineer"}]}]},{name:"Hong Miao",title:"department manager"}]},n=0;n<3;n++)e.children.push({name:"Lao Lao",title:"general manager",children:[{name:"Bo Miao",title:"department manager"},{name:"Su Miao",title:"department manager",children:[{name:"Tie Hua",title:"senior engineer"}]}]});for(var a=e,r=0;r<t;r++)a.children||(a.children=[]),a.children.push({name:"Lao Lao",title:"general manager",children:[{name:"Bo Miao",title:"department manager"},{name:"Su Miao",title:"department manager",children:[{name:"Tie Hua",title:"senior engineer"},{name:"Hei Hei",title:"senior engineer",children:[{name:"Xiang Xiang",title:"UE engineer"}]}]}]}),a=a.children[0];return e}},{key:"generateOrgChartDataFolded",value:function(t,e){for(var n=this.generateOrgChartData(t),a=n,r=0;r<e&&a.children;r++)a=a.children[0];return a._children=a.children,a.children=null,n}}]),t}(),h={name:"org-chart",data:function(){return{data:null,orgChart:null,supportActions:["click node to toggle","drag canvas","use mouse wheel to zoom","button control to zoom"]}},created:function(){this.data=d.generateOrgChartData(10)},mounted:function(){this.orgChart=new l,this.orgChart.draw(this.data)},methods:{test:function(t){this.orgChart.draw(this.data)},bigger:function(){this.orgChart.bigger()},smaller:function(){this.orgChart.smaller()}}},g={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"org-chart-container"}},[n("div",{staticClass:"menu-container"},[n("v-layout",{attrs:{row:""}},[n("v-btn",{on:{click:function(e){t.bigger()}}},[t._v("+")]),t._v(" "),n("v-btn",{on:{click:function(e){t.smaller()}}},[t._v("-")])],1),t._v(" "),n("v-card",[n("v-card-title",[n("div",{staticClass:"action-title",attrs:{slot:"header"},slot:"header"},[n("span",[t._v("Support actions")])]),t._v(" "),t._l(t.supportActions,function(e){return n("div",{key:e,staticClass:"action-item"},[t._v("\n          "+t._s("* "+e)+"\n        ")])})],2)],1)],1)])},staticRenderFns:[]};var v=n("VU/8")(h,g,!1,function(t){n("dyoW")},"data-v-8475cf10",null).exports,f={name:"App",components:{"org-chart":v},data:function(){return{}},created:function(){},methods:{}},m={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-app",[n("v-toolbar",[n("v-toolbar-side-icon"),t._v(" "),n("v-toolbar-title",[t._v("Organization Chart")]),t._v(" "),n("v-spacer"),t._v(" "),n("v-toolbar-items",{staticClass:"hidden-sm-and-down"},[n("v-btn",{attrs:{flat:"",href:"https://github.com/ssthouse"}},[n("v-avatar",{attrs:{size:"42"}},[n("img",{attrs:{src:"https://avatars3.githubusercontent.com/u/10973821?s=460&v=4"}})]),t._v(" "),n("span",{staticStyle:{"margin-left":"8px"}},[t._v("About me")])],1),t._v(" "),n("v-btn",{attrs:{flat:"",href:"https://github.com/ssthouse/organization-chart"}},[n("v-avatar",{attrs:{size:"42"}},[n("img",{attrs:{src:"https://assets-cdn.github.com/images/modules/logos_page/GitHub-Mark.png"}})]),t._v("\n        Source Code")],1)],1)],1),t._v(" "),n("router-view",{staticStyle:{width:"100%",height:"100%"}})],1)},staticRenderFns:[]};var y=n("VU/8")(f,m,!1,function(t){n("FtBh")},null,null).exports,p=n("/ocq"),x=function(){function t(e){i()(this,t),this.treeData=e,this.d3=c,this.nodeWidth=500,this.nodeHeight=500}return s()(t,[{key:"drawTree",value:function(){var t=this.d3.tree().size([this.nodeWidth,this.nodeHeight]);this.treeData=t(this.d3.hierarchy(this.treeData)),this.update(this.treeData.descendants(),this.treeData.links())}},{key:"update",value:function(t,e){this.svg=this.d3.select(".svg");var n=this.svg.selectAll("node").data(t);n.enter().append("rect").attr("class","node").attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width","10").attr("height","10"),n.attr("class","node").attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width","10").attr("height","10"),n.exit().remove();var a=this,r=this.svg.selectAll("link").data(e);r.enter().append("path").attr("class","link").attr("d",function(t,e){return a.d3.linkVertical().x(function(t){return t.x}).y(function(t){return t.y}).source(function(t){return{x:t.source.x,y:t.source.y}}).target(function(){return{x:t.target.x,y:t.target.y}})(t)}),r.attr("class","link"),r.exit().remove()}}]),t}(),C={name:"svg-chart",data:function(){return{svgChart:null}},created:function(){var t=d.generateOrgChartData(10);this.svgChart=new x(t)},mounted:function(){this.start()},methods:{start:function(){this.svgChart.drawTree()},bigger:function(){this.svgChart.bigger()},smaller:function(){this.svgChart.smaller()}}},k={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"svg-chart-container"}},[n("div",{staticClass:"menu-container"},[n("el-row",[n("el-button",{staticStyle:{margin:"20px"},on:{click:function(e){t.start()}}},[t._v("Start")]),t._v(" "),n("el-button",{staticStyle:{margin:"20px"},on:{click:function(e){t.bigger()}}},[t._v("+")]),t._v(" "),n("el-button",{staticStyle:{margin:"20px"},on:{click:function(e){t.smaller()}}},[t._v("-")])],1)],1),t._v(" "),n("svg",{staticClass:"svg"})])},staticRenderFns:[]};var _=n("VU/8")(C,k,!1,function(t){n("I5PC")},null,null).exports;a.a.use(p.a);var b=new p.a({routes:[{path:"/",redirect:"/orgChart"},{path:"/orgChart",name:"orgChart",component:v},{path:"/svgChart",name:"svgChart",component:_}]}),w=n("3EgV"),N=n.n(w);n("7zck");a.a.use(N.a),a.a.config.productionTip=!1,new a.a({el:"#app",router:b,components:{App:y},template:"<App/>"})},dyoW:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.14b75eddb09b9a6cc1ba.js.map